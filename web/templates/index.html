{% extends "template.html" %}
{% block content %}
	<form id="duckysearch">
		<label>Search</label><input name="search" id="search" value="" /><br />
		<label>Index</label><input name="index" id="index" value="ducky" /><br />
		<input type="submit" value="Search" />
	</form>

	<h2>Search results</h2>
	<div>
		<ol id="results">
		</ol>
	</div>

	<script language="javascript">
		$('#duckysearch').submit(function() {
			// empty search results
			$('#results').html('');

			search = encodeURI($('#search').val());
			$('#search').val('');

			source = encodeURI('{ "highlight": { "fields": { "content": {}}} }');
			index = $('#index').val();

			$.getJSON('/api/elasticsearch/' + index + '/_search?q=' + search + '&source=' + source,
				function (data) {
					$.each(data.hits.hits, function(i, item) {
						$('<li>' + _.escape(item._source.filename) + '<span style="color: grey"> &mdash; ' + _.escape(item._source.path) + '</span></li>').appendTo('#results');
						$.each(item.highlight.content, function(i, chunk) {
							$('<span>' + _.escape(chunk) + ' ...</span>').appendTo('#results');
						});
					});
				}
			);

			return false;
		});
	</script>
{% endblock %}
